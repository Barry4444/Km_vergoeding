<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kilometervergoeding ‚Äì Filou Oostende</title>
  <style>
    :root { --bg:#f6f7fb; --fg:#111; --muted:#666; --card:#fff; --line:#e5e7eb; --accent:#0a7a0a; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:var(--bg); color:var(--fg); margin:0; }
    .wrap { max-width: 980px; margin: 36px auto; padding: 0 20px; }
    .card { background:var(--card); border:1px solid var(--line); border-radius:18px; padding:24px; box-shadow: 0 8px 24px rgba(0,0,0,.06); }
    header.card-head { display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom: 8px; }
    .brand-block { display:flex; flex-direction:column; gap:6px; }
    .logo-right img { height:120px; width:auto; display:block; filter: drop-shadow(0 2px 6px rgba(0,0,0,.12)); }
    .road { position: relative; height: 24px; margin: 12px 0 18px; overflow: hidden; }
    .road:before { content:""; position:absolute; left:0; right:0; top:12px; height:2px; border-top:2px dashed #c7ccd6; }
    .car { position: absolute; top:-6px; right:-32px; left:auto; font-size:22px; animation: driveRTL 6s linear infinite; }
    @keyframes driveRTL { from { right:-32px; } to { right: calc(100% + 32px); } }
    label { display:block; margin:12px 0 6px; font-weight:600; }
    input, select, button, textarea { width:100%; padding:12px 14px; border:1px solid var(--line); border-radius:12px; font-size:16px; background:#fff; }
    .row { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    .actions { display:flex; gap:12px; margin-top:18px; flex-wrap:wrap; }
    .btn { background:#111; color:#fff; border:none; padding:12px 14px; border-radius:12px; font-weight:700; cursor:pointer; }
    .btn.secondary { background:#fff; color:#111; border:1px solid #111; }
    .btn.danger { background:#b00020; }
    table { width:100%; border-collapse:collapse; }
    th,td { padding:10px; border-top:1px solid var(--line); text-align:left; }
    .muted { color:#777; font-size:14px; }
    .badge { display:inline-block; padding:6px 10px; border-radius:999px; border:1px solid var(--line); background:#fff; font-weight:600; font-size:13px; }
    .ok { color:#0a7a0a; } .warn { color:#b00020; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header class="card-head">
        <div class="brand-block">
          <h1 style="margin:0">Kilometervergoeding</h1>
          <span class="badge">Formulier ‚Ä¢ Velden compatibel met Code.gs</span>
          <span class="muted">Na <b>Versturen</b> krijg je een bevestiging. De validator ontvangt (optioneel) een mail. Het tarief wordt ingesteld in <i>Config</i>.</span>
        </div>
        <div class="logo-right"><div class="car">üöó</div></div>
      </header>

      <div class="row" style="margin-bottom:8px">
        <div>
          <label for="publicUrl">PUBLIC /exec URL</label>
          <input id="publicUrl" value="https://script.google.com/macros/s/AKfycbzo_uDBC_ytbmxdFOnS0iWP8LFIgyDMKSz84HMD8KSgs8NcsKxeDTWFUzCHD5loTTlXUQ/exec" />
        </div>
        <div>
          <label for="coach_naam">Coach (naam)</label>
          <input id="coach_naam" placeholder="Voornaam Naam" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="gebruiker_email">E-mail aanvrager</label>
          <input id="gebruiker_email" type="email" placeholder="naam@club.be" />
        </div>
        <div>
          <label for="rit_datum">Datum rit</label>
          <input id="rit_datum" type="date" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="bestemming">Bestemming</label>
          <input id="bestemming" placeholder="bv. Leuven (Sportoase)" />
        </div>
        <div>
          <label for="afstand_km">Afstand (heen & terug, km)</label>
          <input id="afstand_km" type="number" step="0.01" inputmode="decimal" placeholder="0" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="ploeg">Ploeg</label>
          <select id="ploeg">
            <option>U21</option>
            <option>U18</option>
            <option>U16</option>
            <option>U14</option>
            <option>Dames</option>
            <option>N/A</option>
          </select>
        </div>
        <div>
          <label for="reden">Reden</label>
          <select id="reden">
            <option>Wedstrijd</option>
            <option>Tornooi</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label for="diverse_omschrijving">Diverse kosten (omschrijving)</label>
          <input id="diverse_omschrijving" placeholder="Parking, tol, ..." />
        </div>
        <div>
          <label for="diverse_bedrag">Diverse kosten (‚Ç¨)</label>
          <input id="diverse_bedrag" type="number" step="0.01" inputmode="decimal" placeholder="0.00" />
        </div>
      </div>

      <div class="actions">
        <button class="btn" id="btnSend">Versturen</button>
        <button class="btn secondary" id="btnReset" type="button">Leegmaken</button>
      </div>

      <p class="muted" id="status"></p>
    </div>
  </div>

<script>
const K_PUBLIC = "filou_public_exec";
function get(k){ try{ return localStorage.getItem(k)||""; }catch(e){ return ""; } }
function set(k,v){ try{ localStorage.setItem(k, v||""); }catch(e){} }
function sanitizeUrl(u){ try{ const x = new URL(u); return x.href; }catch(e){ return ""; } }

function qsPrefill(){
  const qs = new URLSearchParams(location.search);
  if (qs.get("public")) set(K_PUBLIC, sanitizeUrl(qs.get("public")));
  if (qs.get("email")) document.getElementById('gebruiker_email').value = qs.get("email");
  if (qs.get("coach")) document.getElementById('coach_naam').value = qs.get("coach");
}

function refresh(){
  document.getElementById('publicUrl').value = get(K_PUBLIC);
}
function setStatus(html, cls=""){ const el = document.getElementById('status'); el.innerHTML = html; el.className = cls; }

document.getElementById('btnReset').addEventListener('click', ()=>{
  document.querySelectorAll('input,select,textarea').forEach(el=>{
    if (el.id==="publicUrl") return;
    if (el.tagName==="SELECT"){ el.selectedIndex = 0; } else { el.value = ""; }
  });
  setStatus("");
});

document.getElementById('publicUrl').addEventListener('change', (e)=>{
  const u = sanitizeUrl(e.target.value.trim()); set(K_PUBLIC, u); refresh();
});

document.getElementById('btnSend').addEventListener('click', async (e)=>{
  e.preventDefault();
  const base = sanitizeUrl(document.getElementById('publicUrl').value.trim());
  if (!base){ setStatus("Vul eerst de <b>PUBLIC /exec URL</b> in.", "warn"); return; }

  // Build payload matching Code.gs (appendRit)
  const payload = {
    reden: document.getElementById('reden').value,
    ploeg: document.getElementById('ploeg').value,
    afstand_km: document.getElementById('afstand_km').value,
    rit_datum: document.getElementById('rit_datum').value,
    bestemming: document.getElementById('bestemming').value,
    coach_naam: document.getElementById('coach_naam').value,
    gebruiker_email: document.getElementById('gebruiker_email').value,
    diverse_omschrijving: document.getElementById('diverse_omschrijving').value,
    diverse_bedrag: document.getElementById('diverse_bedrag').value
  };

  // Minimal validation
  if (!payload.rit_datum || !payload.afstand_km || !payload.bestemming){
    setStatus("Gelieve <b>datum</b>, <b>afstand</b> en <b>bestemming</b> in te vullen.", "warn"); return;
  }

  set(K_PUBLIC, base); // persist
  setStatus("Bezig met verzenden‚Ä¶");

  try{
    const res = await fetch(base, {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: new URLSearchParams(payload).toString()
    });
    const json = await res.json().catch(()=>({ok:false,error:"Geen JSON"}));
    if (json.ok){
      setStatus(`‚úÖ Verstuurd. ID: <code>${json.id}</code>. Je ontvangt een bevestiging per mail (indien geactiveerd).`, "ok");
    } else {
      setStatus(`‚ùå Mislukt: ${json.error||"onbekende fout"}`, "warn");
    }
  }catch(err){
    setStatus("‚ùå Netwerkfout: " + String(err), "warn");
  }
});

qsPrefill();
refresh();
</script>
</body>
</html>
